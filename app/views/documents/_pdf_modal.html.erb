<dialog id="pdf_modal_<%= document.id %>" class="modal" data-controller="modal">
  <div class="modal-box w-11/12 max-w-[900px] h-[90vh]">
    <div class="flex flex-col space-y-4">
      <!-- Title and URL Section -->
      <div class="flex items-start gap-4 border-b pb-1">
        <div class="flex-1 min-w-0 text-center">
          <h2 class="text-sm font-semibold break-words whitespace-normal"><%= document.file_name %></h2>
          <div class="text-sm text-gray-600">
            <% source = document_source(document.source) %>
            <span class="break-words whitespace-normal">
              <%= document.site.website %> ▸
              <%= source[:text] %>
            </span>
            <% if source[:url].present? %>
              <a href="<%= source[:url] %>" target="_blank" rel="noopener noreferrer" class="ml-1 text-primary-600 hover:text-primary-900" title="Open source in new tab">
                <i class="fas fa-external-link-alt"></i>
              </a>
            <% end %>
          </div>
        </div>
        <button onclick="pdf_modal_<%= document.id %>.close()" class="btn btn-sm btn-circle">✕</button>
      </div>
      <!-- Tab Navigation -->
      <div class="tabs tabs-bordered">
        <button data-modal-target="summaryButton" data-action="modal#showSummaryView" class="tab tab-bordered tab-active">
          Summary
        </button>
        <button data-modal-target="metadataButton" data-action="modal#showMetadataView" class="tab tab-bordered">
          PDF Details
        </button>
        <button data-modal-target="historyButton" data-action="modal#showHistoryView" class="tab tab-bordered">
          History
        </button>
      </div>
      <!-- Summary View (Previously PDF View) -->
      <div data-modal-target="summaryView">
        <!-- Summary Input Area -->
        <div class="flex space-x-2 items-start mb-4">
          <textarea class="textarea textarea-bordered flex-1 h-20 mb-2" placeholder="Enter or view document summary..."></textarea>
          <button class="btn btn-primary btn-sm">
            <i class="fas fa-wand-magic-sparkles mr-1"></i>
            Summarize
          </button>
        </div>
        <iframe src="<%= document.url %>#pagemode=none&toolbar=1" class="w-full h-[calc(90vh-8rem)]" type="application/pdf"></iframe>
      </div>
      <!-- PDF Details View -->
      <div data-modal-target="metadataView" class="hidden h-[calc(90vh-12rem)] overflow-y-auto">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 p-4 mt-4">
          <!-- Document Details -->
          <div>
            <div class="space-y-4">
              <div>
                <div class="text-sm font-medium text-gray-500 mb-1">File Name</div>
                <div class="text-sm text-gray-900 break-words whitespace-normal"><%= document.file_name %></div>
              </div>
              <div class="border-t pt-4">
                <div class="text-sm font-medium text-gray-500 mb-1">Last Modified</div>
                <div class="text-sm text-gray-900"><%= document.modification_date&.strftime("%B %d, %Y") %></div>
              </div>
              <div class="border-t pt-4">
                <div class="text-sm font-medium text-gray-500 mb-1">Type</div>
                <div class="text-sm">
                  <span class="bg-primary-100 text-sm text-gray-900 px-2 py-1 rounded-full">
                    <%= document.document_category.present? ? document.document_category : "uncategorized" %>
                  </span>
                </div>
              </div>
              <div class="border-t pt-4">
                <div class="text-sm font-medium text-gray-500 mb-1">Decision</div>
                <div class="text-sm">
                  <span class="bg-primary-100 text-sm text-gray-900 px-2 py-1 rounded-full">
                    <%= document.accessibility_recommendation.present? ? document.accessibility_recommendation : "undetermined" %>
                  </span>
                </div>
              </div>
              <div class="border-t pt-4">
                <div class="text-sm font-medium text-gray-500 mb-1">Pages</div>
                <div class="text-sm">
                  <span class="bg-primary-100 text-sm text-gray-900 px-2 py-1 rounded-full">
                    <%= document.number_of_pages %>
                  </span>
                </div>
              </div>
            </div>
          </div>
          <!-- Document Metadata -->
          <div>
            <div class="space-y-4">
              <div>
                <div class="text-sm font-medium text-gray-500 mb-1">Author</div>
                <div class="text-sm text-gray-900"><%= document.author %></div>
              </div>
              <div class="border-t pt-4">
                <div class="text-sm font-medium text-gray-500 mb-1">Created</div>
                <div class="text-sm text-gray-900"><%= document.creation_date&.strftime("%B %d, %Y") %></div>
              </div>
              <div class="border-t pt-4">
                <div class="text-sm font-medium text-gray-500 mb-1">Keywords</div>
                <div class="text-sm text-gray-900"><%= document.keywords %></div>
              </div>
              <div class="border-t pt-4">
                <div class="text-sm font-medium text-gray-500 mb-1">Producer</div>
                <div class="text-sm text-gray-900"><%= document.producer %></div>
              </div>
              <div class="border-t pt-4">
                <div class="text-sm font-medium text-gray-500 mb-1">PDF Version</div>
                <div class="text-sm text-gray-900"><%= document.pdf_version %></div>
              </div>
            </div>
          </div>
          <!--  Notes -->
          <div class="col-span-1 md:col-span-2 px-6" data-controller="modal-notes" data-modal-notes-document-id-value="<%= document.id %>">
            <h3 class="text-md font-semibold text-gray-600 mb-2 flex items-center">
              Notes
            </h3>
            <textarea
              data-modal-notes-target="textarea"
              class="w-full h-16 p-2 text-sm border rounded-lg focus:border-primary-500 focus:ring-primary-500"
              placeholder="Add your notes here..."
            ><%= document.notes %></textarea>
            <div class="mt-2 flex justify-end">
              <button class="btn btn-primary btn-sm" data-action="modal-notes#updateNotes">
                <i class="fas fa-save mr-1"></i>
                Update Notes
              </button>
            </div>
          </div>
        </div>
      </div>
      <!-- History View -->
      <div data-modal-target="historyView" class="hidden h-[calc(90vh-12rem)] overflow-y-auto">
        <div class="space-y-4 p-4">
          <h3 class="font-medium text-gray-900">Document History</h3>
          <div class="space-y-2">
            <!-- Placeholder for document history -->
            <p class="text-sm text-gray-500">Document history will be displayed here.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
  <form method="dialog" class="modal-backdrop">
    <button>close</button>
  </form>
</dialog>
